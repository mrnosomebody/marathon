<!DOCTYPE html>
<html lang=ru>
<head>
    <meta charset=utf-8>
    <title>Serejina hernya</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script type="text/javascript">
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        const csrftoken = getCookie('csrftoken');

        function sendUltraPost(id) {
            $.ajax({ // create an AJAX call...
                data: { event_id: id },
                type: 'POST',
                headers: {'X-CSRFToken': csrftoken},
                url: '/join/',
                success: function (response) {
                    $('#join').replaceWith("<span>Вы успешно зарегистрированы!</span>");
                }
            });
        };
    </script>
</head>
<body>
<article class="media content-section">
    <div class="media-body">
        <div class="article-metadata">
            <h2 class="article-title">{{ object.name }} MARATHON</h2>
            <div>
                <a>
                    Organization - {{ object.name }}
                    Place - {{ object.place }}
                    Date - {{ object.date }}
                    Distance - {{ object.distance_id.distance }}
                    {% for run in object.run_set.all %}
                        <div>дебич с никнеймом {{ run.person_id.username }} зарегистрировался</div>
                    {% endfor %}
                </a>
            </div>
        </div>

        <p class="article-content">{{ object.content }}</p>

        <button id='join' onclick="sendUltraPost({{ object.id }})">Join</button>
        <button> Back to list</button>
    </div>
</article>
</body>
</html>